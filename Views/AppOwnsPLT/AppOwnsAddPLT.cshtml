@*
    ----------------------------------------------------------------------------
   This file is the View name AppOwnsAddPLT which is rendered when the user click on the Add PLT button from the Home Page in AppOwnsData mode.
   The controller corresponsding to this view is AppOwnsPLTController.
    ----------------------------------------------------------------------------
*@

@model PLT_Frontend.Models.AppOwnsAuthDetails

@{
    ViewBag.Title = "AppOwnsAddPLT";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    window.onload = function () {
        globals.pltAppMode = "AppOwnsData";

        $('#checktoggle').on('change', () => {
            if ($('#checktoggle').is(":checked")) {
                location.href = '@Url.Action("AppOwnsHomePage", "AppOwnsPLT")';
            }
            else {
                location.href = '@Url.Action("UserOwnsPLTView", "UserOwnsPLT")';
            }
        });

        $(".embed_header_title").on("click", function () {
            location.href = '@Url.Action("AppOwnsAddPLT", "AppOwnsPLT")';
        });
        $(".embed_backbutton").on("click", function () {
            location.href = '@Url.Action("AppOwnsHomePage", "AppOwnsPLT")';
        });
        };
</script>

<header>
    <div>
        <div class="child1">
            <img id="logo-style" src="~/Content/img/Logo.svg"/>
        </div>
        <div class="child1">
            <span id="app_name" class="embed_header_title title_color"><strong class="text_style">Power BI Load Analyzer</strong></span>
        </div>

    </div>
    <div id="tagline"><span class="text_style">Discover, Analyze and Optimize your Desired Report</span></div>
    <div id="toggle_style">
        <div class="user_mode">User</div>
        <input id="checktoggle" type="checkbox" checked />
        <label for="checktoggle" id="myLabel" title="Switch to User"></label>
        <div class="service_principle_mode">Service principal<span class="info_navbar_circle" title="Running as PLTSPN">i</span></div>
    </div>

    <img id="separator" src="~/Content/img/Separator.svg" alt="separator" />

    <div id="userName" class="username cursor">
        <div class="username-container">
            <span id="username_cursor">@Model.Username.Split(' ')[0] @Model.Username.Split(' ')[1]</span>
            <div id="circle"></div>
        </div>
        <div class="user-profile">
            <div class="parent-container">
                <div id="circle2" class="child"></div>
                <div class="container-style">
                    <div id="username-popup" class="username child">@Model.Username.Split(' ')[0] @Model.Username.Split(' ')[1]</div>
                    <div id="useremail-popup" class="useremail child">@Model.Useremail</div>
                </div>
            </div>
            <div class="signout cursor">
                <img class="signout-svg" src="../../Content/img/Sign-out.svg" alt="Sign Out" width="15" height="30"/>
                <span>Sign out</span>
            </div>
        </div>
    </div>
</header>


@*Success or error message*@
<div class="postSaveMessage">
    <p class="postSaveMessageText"></p>
    <span><img class="embed_close-svg cursor" src="../../Content/img/Close.svg" width="17" height="17" alt="Post Save Message" /></span>
</div>

<div class="embed_body">

    <div class="breadcrumb">
        <a class="embed_backbutton cursor">Home page</a>
        <span class="arrow-container"><img src="~/Content/img/Arrow 1.svg" alt="Arrow"></span>
        <span>PLT and Load Testing</span>
    </div>

    <div class="config-container-row">
        <label class="slicer_styling " id="workId" for="workspace-select">Workspace</label><br />
        <select id="workspace-select" class="custom_select">
            <option id="workspace-default-option" value="" disabled selected>Select</option>
        </select>
    </div>

    <div class="embed_table_div_addPLT">
        <table class="reportName_table">
            <thead>
                <tr>
                    <th class="thtable">Report/Page</th>
                    <th id="report_link_column" class="embed_reportName_columns">Report link</th>
                    <th id="load_testing_column" class="embed_reportName_columns">
                        Load testing count <span class="info_circle" title="Enter the number of users you want to simulate using
the page to test the PLT under that specific load">i</span>
                    </th>
                    <th id="action_column" class="embed_reportName_columns">Action</th>
                </tr>
            </thead>
            <tbody id="reports_table"></tbody>
        </table>
    </div>
    <div class="embed_noworkspace_message">
        <img class="embed_workspace_img" src="~/Content/img/SelectWorkspace.svg" alt="embed workspace" />
        <p>No Workspace is selected.<br />Select a workspace to calculate PLT and perform load testing</p>
    </div>
</div>
<div>
    <footer class="footerStyle"><span class="company">Created by <span class="company_name">MAQ</span> Software</span></footer>
</div>


<div class="outer-div">
    <div class="config-container">
        <div id="text-container">
            <!-- Show select list for dashboard(s) -->
            <div id="dashboard-div" class="" hidden>
                <label for="dashboard-select">Choose dashboard</label><br>
                <select id="dashboard-select" class="select-list col-lg-10 col-md-12" disabled>
                    <option value="" disabled selected>Choose dashboard</option>
                </select>
            </div>

            <!-- Show select list for tile(s) -->
            <div id="tile-div" class="" hidden>
                <label for="tile-select">Choose tile</label><br>
                <select id="tile-select" class="select-list col-lg-10 col-md-12" disabled>
                    <option value="" disabled selected>Choose tile</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Show errors to the user -->
    <div class="tablesContainer">
    </div>

    <!-- Placeholder div when Power BI report is not embedded -->
    <div class="report-wrapper col-lg-12 col-md-12 mt-12" hidden>
        <img src="~/Content/img/spinner.svg" id="report-spinner" class="spinner col-lg-12 col-md-12" alt="loader">
        <div id="report-container" class="report-container col-lg-12 col-md-12 mt-12"></div>
        <div class="report-display-text col-lg-12 col-md-12">Select workspace and report</div>
    </div>

    <!-- Placeholder div when Power BI dashboard is not embedded -->
    <div class="dashboard-wrapper col-lg-12 col-md-12 mt-12" hidden>
        <img src="~/Content/img/spinner.svg" id="dashboard-spinner" class="spinner col-lg-12 col-md-12" alt="loader">
        <div id="dashboard-container" class="dashboard-container col-lg-12 col-md-12 mt-12"></div>
        <div class="dashboard-display-text col-lg-12 col-md-12">Select workspace and dashboard</div>
    </div>

    <!-- Placeholder div when Power BI tile is not embedded -->
    <div class="tile-wrapper col-lg-12 col-md-12 mt-12" hidden>
        <img src="~/Content/img/spinner.svg" id="tile-spinner" class="spinner col-lg-12 col-md-12" alt="loader">
        <div id="tile-container" class="tile-container col-lg-12 col-md-12 mt-12"></div>
        <div class="tile-display-text col-lg-12 col-md-12">Select workspace, dashboard and tile</div>
    </div>
</div>


<script>
    loggedInUser.accessToken = "@Model.AccessToken";

    // Retrieve Power BI hostname from Web.config file
    globals.powerBiHostname = '@System.Configuration.ConfigurationManager.AppSettings["powerBiHostname"]';

    // Cache base endpoint for Power BI REST API
    globals.powerBiApi = '@System.Configuration.ConfigurationManager.AppSettings["powerBiApiUrl"]' + '/v1.0/myorg';

    // Get the username text
    let username = document.querySelector('#username_cursor').textContent;

    // Split the username into an array of words
    let nameArr = username.split(' ');
    // Get the first letters of the first name and last name
    let firstLetter = nameArr[0].charAt(0);
    let lastLetter = nameArr[1].charAt(0);

    // Get the circle element
    let circle = document.querySelector('#circle');
    let circle2 = document.querySelector('#circle2');

    // Add the first letters inside the circle
    circle.textContent = firstLetter + lastLetter;
    circle2.textContent = firstLetter + lastLetter;
</script>